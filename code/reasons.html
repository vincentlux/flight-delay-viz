<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
    <title>How should I fly?</title>
    
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <!-- Core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/paper-dashboard.css" rel="stylesheet"/>

    <!--  Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/themify-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

<style>

.chart-wrapper {
	width: 850px;
	height: 550px;
	margin: auto;
	background-color: #FAF7F7;
}

.chart-wrapper2 {
	width: 950px;
	height: 450px;
	margin: auto;
	background-color: #FAF7F7;
}

.chart-wrapper .inner-wrapper {
	position: relative;
	padding-bottom: 50%;
	width: 100%;
}

.chart-wrapper .outer-box {
	position: absolute;
	top: 0; bottom: 0; left: 0; right: 0;
}

.chart-wrapper .inner-box {
	width: 100%;
	height: 100%;
}

.chart-wrapper text {
	font-family: sans-serif;
	font-size: 14px;
}

.chart-wrapper p {
	font-size: 16px;
	margin-top:5px;
	margin-bottom: 40px;
}

.chart-wrapper .axis path,
.chart-wrapper .axis line {
	fill: none;
	stroke: #1F1F2E;
	stroke-opacity: 0.9;
	shape-rendering: crispEdges;

}
.chart-wrapper .axis path {
	stroke-width: 5px;
}

.chart-wrapper .line {
	fill: none;
	stroke: steelblue;
	stroke-width: 5px;
}

.chart-wrapper .legend  {
	min-width: 200px;
	display: flex;
	justify-content: flex-start;
	flex-wrap: wrap;
	font-size: 16px;
	padding: 10px 40px;
}
.chart-wrapper .legend > div {
	margin: 75px 25px 0px 20px;
	flex-grow: 0;
}
.chart-wrapper .legend p {
	display:inline;
	font-size: 0.8em;
	font-family: sans-serif;
	font-weight: 600;
}
.chart-wrapper .legend .series-marker {
	height: 1em;
	width: 1em;
	border-radius: 35%;
	background-color: crimson;
	display: inline-block;
	margin-right: 4px;
	margin-bottom: -0.16rem;
}

.chart-wrapper .overlay {
	fill: none;
	pointer-events: all;
}

.chart-wrapper .focus circle {
	fill: crimson;
	stroke: crimson;
	stroke-width: 2px;
	fill-opacity: 15%;
}
.chart-wrapper .focus rect {
	fill: lightblue;
	opacity: 0.4;
	border-radius: 2px;
}
.chart-wrapper .focus.line {
	stroke: steelblue;
	stroke-dasharray: 2,5;
	stroke-width: 2;
	opacity: 0.5;
}
@media (max-width:500px){
	.chart-wrapper .line {stroke-width: 3px;}
	.chart-wrapper .legend {font-size: 14px;}
}

rect.bordered {
	stroke: darkgray;
	stroke-width:2px;   
}
</style>

</head>
<body>

<div class="wrapper">
    <div class="sidebar" data-background-color="white">

    	<div class="sidebar-wrapper">
            <div class="logo">
                <a class="simple-text">
                    HOW SHOULD I FLY?
                </a>
            </div>
            <div class="nav">
                <form>
                    
                    <div style="background-color:#D9D9D9; border-radius: 12px; margin-top:100px">
                        <p style="font-size:16px; line-height:3; text-align: center;  margin-top: 20px">Year</p>
        
                        <p style="font-size:16px; line-height:3; margin:10px; text-align: right">
                            <!-- dropdown menu for departure airport, generated by choice of state -->
                            <select name="departure_airport" id="departure_airport" style="width:100%; padding: 10px; margin-bottom: 50px; border-radius: 10px">
                                <option value="" disabled selected>Select an year</option>
                            </select>
                        </p>
                    </div>
                    <!-- adapted from https://stackoverflow.com/questions/30232146/dynamically-populating-drop-down-list-from-selection-of-another-drop-down-value -->
                    <div style="background-color:rgb(228, 228, 228); border-radius: 12px">
                        <p style="font-size:16px; line-height:3; margin:10px; text-align: center; background-color:rgb(228, 228, 228); margin-top: 30px">Carrier</p>
    
                        <p style="font-size:16px; line-height:3; margin:10px; text-align: right">
                            <!-- dropdown menu for arrival airport, generated by choice of state -->
                            <select name="arrival_airport" id="arrival_airport" style="width:100%; padding: 10px; margin-bottom: 50px; border-radius: 10px">
                                <option value="" disabled selected>Select an carrier</option>
                            </select>
                        </p>
                    </div>
    
                    
    
                    <!-- submit button for the departure and arrival parameters, which will visualize the data for that route -->
                    <p style="padding-left: 25px; margin-top: 20px">
                        <!-- <button name="go" id="go" type="submit" onclick="retrieveRouteData()">Go!</button> -->
                        <input name="go" id="go" type="submit" onclick="retrieveRouteData()" style="font-size:20px; line-height:2; margin: 10px; text-align: center; background-color:rgba(171, 148, 83, 0.692); color: #373F27; width: 80%; border: 1em; border-color: black; border-radius: 10px">
                    </p>
                </form>
            </div>
        </div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default" style="background-color:#99bedd85">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar bar1"></span>
                        <span class="icon-bar bar3"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Flight Dashboard</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="dashboard.html">
                                <i class="ti-panel" style="color:rgb(54, 54, 54)"></i>
								<p style="color:rgb(54, 54, 54)">Severity of Delay</p>
                            </a>
                        </li>
						<li>
                            <a href="reasons.html" style="margin-left:30px; margin-right:30px">
								<i class="ti-settings" style="color:rgb(54, 54, 54)"></i>
								<p style="color:rgb(54, 54, 54)">Cause of Delay</p>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

<!-- LINECHART -->
        <div class="content" style="padding-top:30px; padding-bottom: 10px">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title" style="font-weight:bold">Flight Delay Reasons</h4>
                                <p class="category" style="font-weight:bold">12 Carriers / 5 Years Performance</p>
                            </div>
                            <div class="content">
                                <div class="chart">
                                    <div class="chart-wrapper" id="chart-line1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>

<script type="text/javascript">

    // Reference
    // http://bl.ocks.org/asielen/44ffca2877d0132572cb

    // =====================================================================================

    var data = [
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 20.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 30.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 15.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 27.0},
        {FlightDate:"2017-01-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 16.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 20.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 5.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 1.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 8.0, SecurityDelay: 0.0, LateAircraftDelay: 34.0},
        {FlightDate:"2017-02-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 8.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 7.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 9.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 40.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 5.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 20.0},
        {FlightDate:"2017-03-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 26.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 9.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 4.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 16.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 8.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 8.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 44.0},
        {FlightDate:"2017-04-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 20.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 35.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 7.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 10.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 15.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 54.0},
        {FlightDate:"2017-05-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 8.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 5.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 3.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 9.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 30.0},
        {FlightDate:"2017-06-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 20.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 30.0, NASDelay: 7.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 5.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 42.0},
        {FlightDate:"2017-07-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 20.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 30.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 8.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 22.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 4.0},
        {FlightDate:"2017-08-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 7.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 9.0, NASDelay: 0.0, SecurityDelay: .0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 5.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 30.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 15.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 24.0},
        {FlightDate:"2017-09-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 2.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 7.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 30.0, NASDelay: 0.0, SecurityDelay: 8.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 10.0, WeatherDelay: 0.0, NASDelay: 4.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 3.0, NASDelay: 0.0, SecurityDelay: 5.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 5.0},
        {FlightDate:"2017-10-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 20.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 7.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 30.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 9.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 8.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 7.0, NASDelay: 0.0, SecurityDelay: 15.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 4.0},
        {FlightDate:"2017-11-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 18.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 3.0, NASDelay: 0.0, SecurityDelay: 8.0, LateAircraftDelay: 5.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 6.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 40.0, SecurityDelay: 1.0, LateAircraftDelay: 0.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: 0.0, SecurityDelay: 0.0, LateAircraftDelay: 4.0},
        {FlightDate:"2017-12-17", UniqueCarrier: "AA", CarrierDelay: 0.0, WeatherDelay: 0.0, NASDelay: .0, SecurityDelay: 0.0, LateAircraftDelay: 0.0},

]
    
    dataGetReady(data);
    
    function dataGetReady(data){
        var oneDigit = d3.format(".1f");
        var arrayNested = d3.nest()
            .key(function(d) {return d.UniqueCarrier;})
            .key(function(d) { return d.FlightDate.substring(5).replace("-","."); })
            .rollup(function(d) {return {
                carrier: oneDigit(d3.mean(d, function(s) { return s.CarrierDelay; })),
                weather: oneDigit(d3.mean(d, function(s) { return s.WeatherDelay; })),
                nas: oneDigit(d3.mean(d, function(s) { return s.NASDelay; })),
                security: oneDigit(d3.mean(d, function(s) { return s.SecurityDelay; })),
                aircraft: oneDigit(d3.mean(d, function(s) { return s.LateAircraftDelay; }))
            }; })
            .entries(data) 

        // Get flattened data {airline: "AA", FlightDate: "01.17", carrier: "2.9", 
        //                     weather: "4.3", nas: "2.6", security: "2.1", aircraft: "7.7"}
        var flattened = [];
        arrayNested.forEach(function(airline) {
            airline.values.forEach(function(flight) {
                flattened.push({
                    airline: airline.key,
                    FlightDate: flight.key,
                    carrier: flight.values.carrier,
                    weather: flight.values.weather,
                    nas: flight.values.nas,
                    security: flight.values.security,
                    aircraft: flight.values.aircraft
                });  
            });
        });

        // input should be flattened
        flattened.forEach(function(d) {
            airline = +d.UniqueCarrier,
            FlightDate = +d.FlightDate,
            carrier = +d.carrier,
            weather = +d.weather,
            nas = +d.nas,
            security = +d.security,
            aircraft = +d.aircraft
        });
        //console.log(flattened)

        // =================================================================================================
        var chart = makeLineChart(flattened, 
                                'FlightDate', 
                                {'Carrier Delay': {column: 'carrier'},
                                'Weather Delay': {column: 'weather'},
                                'NAS Delay': {column: 'nas'},
                                'Security Delay': {column: 'security'},
                                'Late Aircraft Delay': {column: 'aircraft'}}, 
                                {xAxis: 'Dates', yAxis: 'Severity of Delay (minutes)'}
                            );
        
        chart.bind("#chart-line1");
        chart.render();
    };
    


    function makeLineChart(dataset, xName, yObjs, axisLables) {
        var chartObj = {};
        var color = d3.scale.category10();
        chartObj.xAxisLable = axisLables.xAxis;
        chartObj.yAxisLable = axisLables.yAxis;
        chartObj.data = dataset;
        chartObj.margin = {top: 15, right: 60, bottom: 30, left: 100};
        chartObj.width = 800 - chartObj.margin.left - chartObj.margin.right;
        chartObj.height = 480 - chartObj.margin.top - chartObj.margin.bottom;

        // So we can pass the x and y as strings when creating the function
        chartObj.xFunct = function(d){return d[xName]};

        // For each yObjs argument, create a yFunction
        function getYFn(column) {
            return function (d) {
                return d[column];
            };
        }

        // Object instead of array
        chartObj.yFuncts = [];
        for (var y in yObjs) {
            yObjs[y].name = y;
            yObjs[y].yFunct = getYFn(yObjs[y].column);
            chartObj.yFuncts.push(yObjs[y].yFunct);
        }

        // Return the max of every yFunct
        chartObj.max = function (fn) {
            return d3.max(chartObj.data, fn);
        };

        // Create scale functions
        chartObj.xScale = d3.scale.linear()
            .range([0, chartObj.width])
            .domain(d3.extent(chartObj.data, chartObj.xFunct));        

        chartObj.yScale = d3.scale.linear()
            .range([chartObj.height, 0])
            .domain([0, d3.max(chartObj.yFuncts.map(chartObj.max))]);
   
        
        // Create axis
        chartObj.xAxis = d3.svg.axis()
            .scale(chartObj.xScale)
            .orient("bottom")
            .ticks(6)
            .tickSize(10)
            .tickFormat(d3.format(".0f")); 

        chartObj.yAxis = d3.svg.axis()
            .scale(chartObj.yScale)
            .orient("left")
            .tickSize(10); 

        //Formatter functions for the axes
        chartObj.xFormatter = d3.format(".0f");
        chartObj.yFormatter = d3.format(".2f");

        chartObj.bisectYear = d3.bisector(chartObj.xFunct).left; 

        // Build line building functions
        function getYScaleFn(yObj) {
            return function (d) {
                return chartObj.yScale(yObjs[yObj].yFunct(d));
            };
        }
        
        for (var yObj in yObjs) {
            yObjs[yObj].line = d3.svg.line().interpolate("cardinal").x(function (d) {
                return chartObj.xScale(chartObj.xFunct(d));
            }).y(getYScaleFn(yObj));
        }
        

        chartObj.svg;

        
        chartObj.bind = function (selector) {
            chartObj.mainDiv = d3.select(selector);
            // Add all the divs to make it centered and responsive
            chartObj.mainDiv.append("div")
                .attr("class", "inner-wrapper")
                .append("div")
                .attr("class", "outer-box")
                .append("div")
                .attr("class", "inner-box");
            chartSelector = selector + " .inner-box";
            chartObj.chartDiv = d3.select(chartSelector);
            return chartObj;
        };

        // Render the chart
        chartObj.render = function () {
            //Create SVG element
            chartObj.svg = chartObj.chartDiv.append("svg")
                .attr("class", "chart-area")
                .attr("width", chartObj.width + (chartObj.margin.left + chartObj.margin.right))
                .attr("height", chartObj.height + (chartObj.margin.top + chartObj.margin.bottom))
                .append("g")
                .attr("transform", "translate(" + chartObj.margin.left + "," + chartObj.margin.top + ")");       

            // Draw Lines
            for (var y  in yObjs) {
                yObjs[y].path = chartObj.svg.append("path")
                    .datum(chartObj.data)
                    .attr("class", "line")
                    .attr("d", yObjs[y].line)
                    .style("stroke", color(y))
                    .attr("data-series", y)
                    .on("mouseover", function () {
                        focus.style("display", null);
                    })
                    .on("mouseout", function () {
                        focus.transition().delay(700).style("display", "none");
                    })
                    .on("mousemove", mousemove);
            }

            // Draw Axis
            chartObj.svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + chartObj.height + ")")
                .call(chartObj.xAxis)
                .append("text")
                .attr("class", "label")
                .attr("x", chartObj.width / 2)
                .attr("y", 30)
                .style("text-anchor", "middle")
                .text(chartObj.xAxisLable);

            chartObj.svg.append("g")
                .attr("class", "y axis")
                .call(chartObj.yAxis)
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", -42)
                .attr("x", -chartObj.height / 2)
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(chartObj.yAxisLable);


            //Draw legend
            var legend = chartObj.mainDiv.append('div').attr("class", "legend");
            for (var y  in yObjs) {
                series = legend.append('div');
                series.append('div')
                    .attr("class", "series-marker")
                    .style("background-color", color(y));
                series.append('p').text(y);
                yObjs[y].legend = series;
            }

            // Draw tooltips
            var focus = chartObj.svg.append("g")
                .attr("class", "focus")
                .style("display", "none");

            for (var y  in yObjs) {
                yObjs[y].tooltip = focus.append("g");
                yObjs[y].tooltip.append("circle")
                    .attr("r", 5);
                yObjs[y].tooltip.append("rect")
                    .attr("x", 8)
                    .attr("y","-5")
                    .attr("width",22)
                    .attr("height",'0.75em');
                yObjs[y].tooltip.append("text")
                    .attr("x", 9)
                    .attr("dy", ".35em");
            }

            // Date label
            focus.append("text")
                .attr("class", "focus date")
                .attr("x", 9)
                .attr("y", 7);
            // Focus line
            focus.append("line")
                .attr("class", "focus line")
                .attr("y1", 0)
                .attr("y2", chartObj.height);

            // Overlay to capture hover
            chartObj.svg.append("rect")
                .attr("class", "overlay")
                .attr("width", chartObj.width)
                .attr("height", chartObj.height)
                .on("mouseover", function () {
                    focus.style("display", null);
                })
                .on("mouseout", function () {
                    focus.style("display", "none");
                })
                .on("mousemove", mousemove);

            return chartObj;
            function mousemove() {
                var x0 = chartObj.xScale.invert(d3.mouse(this)[0]), 
                    i = chartObj.bisectYear(dataset, x0, 1), 
                    d0 = chartObj.data[i - 1], d1 = chartObj.data[i];
                try {
                    var d = x0 - chartObj.xFunct(d0) > chartObj.xFunct(d1) - x0 ? d1 : d0;
                } catch (e) { return;}
                minY = chartObj.height;
                for (var y  in yObjs) {
                    yObjs[y].tooltip
                        .attr("transform", "translate(" + chartObj.xScale(chartObj.xFunct(d)) + "," + chartObj.yScale(yObjs[y].yFunct(d)) + ")");
                    yObjs[y].tooltip
                        .select("text")
                        .text(chartObj.yFormatter(yObjs[y].yFunct(d)));
                    minY = Math.min(minY, chartObj.yScale(yObjs[y].yFunct(d)));
                }

                focus.select(".focus.line")
                    .attr("transform", "translate(" + chartObj.xScale(chartObj.xFunct(d)) + ")")
                    .attr("y1", minY);
                focus.select(".focus.date")
                    .text("Date: " + chartObj.yFormatter(chartObj.xFunct(d)));
            }
            
        };
        return chartObj;
    }

</script>

</html>